<!DOCTYPE html>
<html>
  <head>
    <base target="_blank" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>App Launcher</title>
    <style>
      :root{
        --bg:#0a1228;          /* deep dark blue background */
        --panel:#111c3a;       /* panel slightly lighter dark blue */
        --border:#1f2b4a;      /* border tone */
        --muted:#94a3b8;       /* muted grey text */
        --text:#ffffff;        /* main text white */
        --accent:#0054a8;      /* red accent (primary buttons) old #ef4444 */
        --accent-dark:#0147ad; /* darker red for hover gradient old #b91c1c */
        --accent-text:#ffffff; /* button text white */
      }

      *{box-sizing:border-box;margin:0;padding:0}
      html,body{height:100%}
      body{
        font-family: Inter, system-ui, Arial, sans-serif;
        background:var(--bg);
        color:var(--text);
      }

      /* Layout */
      .wrap{max-width:960px;margin:24px auto;padding:0 16px}
      .card{
        background:var(--panel);
        border:1px solid var(--border);
        border-radius:14px;
        padding:16px;
      }
      h1{font-size:20px;margin-bottom:10px;font-weight:700}

      /* Top bar */
      .topbar{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-bottom:12px}
      .search,.select{
        height:40px;padding:0 12px;border:1px solid var(--border);border-radius:10px;
        background:#0f172a;color:var(--text);outline:none;
      }
      .search{flex:1 1 280px}
      .select{flex:0 0 220px}
      .search::placeholder{color:var(--muted)}
      .count{font-size:13px;color:var(--muted)}

      /* Grid */
      .grid{
        display:grid;gap:12px;
        grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
        align-items:stretch;
      }

      /* POS button style */
      .pos-btn{
        display:flex;align-items:center;justify-content:center;gap:8px;
        min-height:56px;padding:14px 16px;border-radius:12px;text-decoration:none;font-weight:600;
        background:linear-gradient(180deg,var(--accent),var(--accent-dark));
        color:var(--accent-text);
        border:1px solid var(--accent-dark);
        box-shadow:0 6px 14px rgba(239,68,68,.25);
        transition:transform .08s ease, box-shadow .08s ease, filter .08s ease, opacity .08s ease;
        text-align:center;
      }
      .pos-btn:hover{
        transform:translateY(-1px);
        filter:brightness(1.03);
        box-shadow:0 10px 22px rgba(239,68,68,.35);
      }
      .pos-btn:active{
        transform:translateY(0);
        filter:brightness(.95);
        box-shadow:0 4px 10px rgba(239,68,68,.2);
      }

      .muted{color:var(--muted);font-size:14px}
      .empty{
        padding:20px;border:1px dashed var(--border);border-radius:12px;
        text-align:center;color:var(--muted)
      }

      /* Small “badge” look for category */
      .right-badge{
        margin-left:8px;padding:.5px 6px;border-radius:999px;
        background:rgba(255,255,255,.12);font-size:12px;font-weight:600;color:var(--text);
      }
      /* Category cards layout */
      .cats{
        display:grid;
        gap:12px;
        grid-template-columns:repeat(auto-fill, minmax(260px, 1fr));
        align-items:start;
      }

      .cat-card{
        background:#0f172a;
        border:1px solid var(--border);
        border-radius:12px;
        padding:12px;
      }

      .cat-grid{
        display:grid;
        gap:8px;
        grid-template-columns:1fr; /* apps stack inside the card */
      }
      .cat-block{
        margin-bottom:24px;
        padding:12px;
        border:1px solid var(--border);
        border-radius:12px;
        background:#0f172a;
      }
      .cat-title{
        font-size:16px;
        font-weight:700;
        margin-bottom:10px;
        color:var(--muted);
      }
      .cat-row{
        display:flex;
        flex-wrap:wrap;
        gap:12px;
      }
      /* Keep app buttons horizontal with wrap + consistent width */
      .cat-row .pos-btn { flex: 1 1 220px; }

    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="card">
        <h1>App Launcher</h1>
        <div class="topbar">
          <input id="q" class="search" type="search" placeholder="Search apps by name or category…" oninput="render()" />
          <select id="cat" class="select" onchange="render()">
            <option value="">All categories</option>
          </select>
          <div class="count" id="count"></div>
        </div>

        <div id="list"></div>
        <div id="empty" class="empty" style="display:none;">No apps found.</div>

        <div class="muted" style="margin-top:10px">
          Source: “Sheet Directory” (B: Name, C: Category, D: Link)
        </div>
      </div>
    </div>

    <script>
        const state = { apps: [], filtered: [] };
      
        function fetchApps(){
          google.script.run
            .withSuccessHandler(apps => {
              state.apps = Array.isArray(apps) ? apps : [];
              buildCategories();
              render();
            })
            .withFailureHandler(err => {
              document.getElementById('list').innerHTML =
                `<div class="empty">Error loading apps: ${escapeHtml(String(err))}</div>`;
            })
            .getApps();
        }
      
        function buildCategories(){
          const sel = document.getElementById('cat');
          const current = sel.value;
          const cats = Array.from(new Set(
            state.apps.map(a => (a.category || '').trim()).filter(Boolean)
          )).sort((a,b)=>a.localeCompare(b, undefined, {sensitivity:'base'}));
          sel.innerHTML = `<option value="">All categories</option>` + 
            cats.map(c => `<option value="${escapeAttr(c)}">${escapeHtml(c)}</option>`).join('');
          if (current && cats.includes(current)) sel.value = current;
        }
      
        function render(){
        const q = (document.getElementById('q').value || '').toLowerCase().trim();
        const cat = document.getElementById('cat') ? document.getElementById('cat').value : '';

        state.filtered = state.apps.filter(a => {
          const inSearch = !q || (a.name && a.name.toLowerCase().includes(q)) || (a.category && a.category.toLowerCase().includes(q));
          const inCat = !cat || (a.category || '') === cat;
          return inSearch && inCat;
        });

        const list = document.getElementById('list');
        const empty = document.getElementById('empty');
        const count = document.getElementById('count');
        count.textContent = state.filtered.length ? `${state.filtered.length} app(s)` : '';

        if (!state.filtered.length){
          list.innerHTML = '';
          empty.style.display = 'block';
          return;
        }
        empty.style.display = 'none';

        // group apps by category
        const grouped = {};
        state.filtered.forEach(a => {
          const key = a.category || 'Uncategorized';
          (grouped[key] ||= []).push(a);
        });

        // render blocks with horizontal app rows
        list.innerHTML = Object.keys(grouped).sort().map(catName => `
          <div class="cat-block">
            <div class="cat-title">${escapeHtml(catName)}</div>
            <div class="cat-row">
              ${grouped[catName]
                .sort((a,b)=>a.name.localeCompare(b.name, undefined, {sensitivity:'base'}))
                .map(a => `
                  <a class="pos-btn" href="${escapeAttr(a.url)}" rel="noopener noreferrer">
                    ${escapeHtml(a.name)}
                  </a>
                `).join('')}
            </div>
          </div>
        `).join('');
      }

            // helpers
      function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
      function escapeAttr(s){ return String(s).replace(/"/g,'&quot;'); }
      
        fetchApps();
      </script>

  </body>
</html>
